!function(e){"use strict";e.fn.datePicker=function(t){return this.each(function(){function l(){if(k=m.val(),e("#datePlugin").size()||e("body").append('<div id="datePlugin"></div>'),document.getElementsByTagName("body")[0].addEventListener("touchmove",a,!1),O.curdate||""==e.trim(k))g=parseInt(h.getFullYear())-parseInt(O.beginyear)+1,S=parseInt(h.getMonth())+1,T=parseInt(h.getDate()),E=parseInt(h.getHours())+1,w=parseInt(h.getMinutes())+1,_=parseInt(h.getSeconds());else{var t=null,l=null;("date"==O.theme||"datetime"==O.theme)&&(t=k.split(" ")[0],g=parseInt(t.split("-")[0]-parseInt(O.beginyear))+1,S=parseInt(t.split("-")[1]),T=parseInt(t.split("-")[2])),"datetime"==O.theme&&(l=k.split(" ")[1],E=parseInt(l.split(":")[0])+1,w=parseInt(l.split(":")[1])+1),"time"==O.theme&&(l=k,E=parseInt(l.split(":")[0])+1,w=parseInt(l.split(":")[1])+1),"month"==O.theme&&(t=k,g=parseInt(t.split("-")[0]-parseInt(O.beginyear))+1,S=parseInt(t.split("-")[1]))}e("#datePlugin").show(),i(),e("#d-okBtn").on("click",function(){document.getElementsByTagName("body")[0].removeEventListener("touchmove",a,!1),e("#yearScroll li").eq(g).data("num"),e("#monthScroll li").eq(S).data("num"),e("#dayScroll li").eq(T).data("num"),m.val(e(".d-return-info").html()),e("#datePlugin").hide().html(""),O.callBack()}),e("#d-cancleBtn").on("click",function(){e("#datePlugin").hide().html(""),document.getElementsByTagName("body")[0].removeEventListener("touchmove",a,!1)})}function a(e){e.preventDefault()}function n(e){return 0==e%4&&0!=e%100||0==e%400?!0:!1}function i(){var t=' <div class="d-date-box"><div class="d-date-title">请选择日期</div><p class="d-date-info"><span class="d-day-info"></span><span class="d-return-info"></span></p></div>',l='<div class="d-date-btns"><button class="d-btn" id="d-okBtn">确定</button><button class="d-btn" id="d-cancleBtn">取消</button></div>',a='<div class="d-date-wrap">';a+='<div class="d-date-mark"></div>',a+='<div class="d-year-wrap d-date-cell" id="yearScroll"><ul></ul></div>',a+='<div class="d-month-wrap d-date-cell" id="monthScroll"><ul></ul></div>',a+='<div class="d-day-wrap d-date-cell" id="dayScroll"><ul></ul></div>',a+="</div>";var n='<div class="d-date-wrap d-time-wrap">';n+='<div class="d-date-mark"></div>',n+='<div class="d-hour-wrap d-date-cell" id="hourScroll"><ul></ul></div>',n+='<div class="d-minute-wrap d-date-cell" id="minuteScroll"><ul></ul></div>',n+="</div>";var i='<div class="d-date-wrap">';switch(i+='<div class="d-date-mark"></div>',i+='<div class="d-year-wrap d-date-cell" style="width:50%" id="yearScroll"><ul></ul></div>',i+='<div class="d-month-wrap d-date-cell" style="width:50%" id="monthScroll"><ul></ul></div>',i+="</div>",e("#datePlugin").html(t),O.theme){case"date":e(".d-date-box").append(a),d(),r(),c(O.monthDay[S-1]);break;case"datetime":e(".d-date-box").append(a),e(".d-date-box").append(n),d(),r(),c(O.monthDay[S-1]),s(),u();break;case"time":e(".d-date-box").append(n),s(),u();break;case"month":e(".d-date-box").append(i),d(),r();break;default:e(".d-date-box").append(a),d(),r(),c(O.monthDay[S-1])}e(".d-date-box").append(l),o()}function o(){var t=e("#yearScroll li").eq(g).data("num"),l=e("#monthScroll li").eq(S).data("num"),a=e("#dayScroll li").eq(T).data("num"),n=e("#hourScroll li").eq(E).data("num"),i=e("#minuteScroll li").eq(w).data("num"),o=new Date(t+"-"+l+"-"+a);switch(O.theme){case"date":e(".d-day-info").html(O.days[o.getDay()]+"&nbsp;"),e(".d-return-info").html(t+"-"+l+"-"+a);break;case"datetime":e(".d-day-info").html(O.days[o.getDay()]+"&nbsp;"),e(".d-return-info").html(t+"-"+l+"-"+a+" "+n+":"+i);break;case"time":e(".d-return-info").html(n+":"+i);break;case"month":e(".d-return-info").html(t+"-"+l);break;default:e(".d-day-info").html(O.days[o.getDay()]+"&nbsp;"),e(".d-return-info").html(t+"-"+l+"-"+a)}}function d(){for(var t=e("#yearScroll"),l=O.endyear-O.beginyear,a="<li></li>",i=0;l>=i;i++)a+="<li data-num="+(O.beginyear+i)+">"+(O.beginyear+i)+"年</li>";t.find("ul").html(a).append("<li></li>"),p=new IScroll("#yearScroll",O.scrollOpt),p.scrollTo(0,-(g-1)*O.liH),p.on("scrollEnd",function(){var e=Math.floor(-this.y/O.liH);g=e+1,O.monthDay[1]=n(parseInt(t.find("li").eq(g).data("num")))?29:28,2==S&&"month"!=O.theme&&c(O.monthDay[S-1]),o()})}function r(){for(var t=e("#monthScroll"),l="<li></li>",a=1;12>=a;a++)l+=10>a?'<li data-num="0'+a+'">0'+a+"月</li>":'<li data-num="'+a+'">'+a+"月</li>";t.find("ul").html(l).append("<li></li>"),f=new IScroll("#monthScroll",O.scrollOpt),f.scrollTo(0,-(S-1)*O.liH),f.on("scrollEnd",function(){var e=Math.floor(-this.y/O.liH),t=O.monthDay[e];S=e+1,"month"!=O.theme&&c(t),o()})}function c(t){for(var l=e("#dayScroll"),a="<li></li>",n=1;t>=n;n++)a+=10>n?'<li data-num="0'+n+'">0'+n+"日</li>":'<li data-num="'+n+'">'+n+"日</li>";l.find("ul").html(a).append("<li></li>"),v&&(v.destroy(),v=null),v=new IScroll("#dayScroll",O.scrollOpt),T>O.monthDay[S-1]&&(T=1),v.scrollTo(0,-(T-1)*O.liH),v.on("scrollEnd",function(){T=Math.floor(-this.y/O.liH)+1,o()})}function s(){for(var t=e("#hourScroll"),l="<li></li>",a=O.beginhour;a<=O.endhour;a++)l+=10>a?'<li data-num="0'+a+'">0'+a+"时</li>":'<li data-num="'+a+'">'+a+"时</li>";t.find("ul").html(l).append("<li></li>"),y&&(y.destroy(),y=null),y=new IScroll("#hourScroll",O.scrollOpt),y.scrollTo(0,-(E-1)*O.liH),y.on("scrollEnd",function(){E=Math.floor(-this.y/O.liH)+1,o()})}function u(){for(var t=e("#minuteScroll"),l="<li></li>",a=0;59>=a;a++)l+=10>a?'<li data-num="0'+a+'">0'+a+"分</li>":'<li data-num="'+a+'">'+a+"分</li>";t.find("ul").html(l).append("<li></li>"),b&&(b.destroy(),b=null),b=new IScroll("#minuteScroll",O.scrollOpt),b.scrollTo(0,-(w-1)*O.liH),b.on("scrollEnd",function(){w=Math.floor(-this.y/O.liH)+1,o()})}var m=e(this),h=(e(this).is("input"),new Date),p=null,f=null,v=null,y=null,b=null,g=null,S=null,T=null,E=null,w=null,_=null,k=null;e.fn.datePicker.defaultOptions={beginyear:2010,endyear:2020,monthDay:[31,28,31,30,31,30,31,31,30,31,30,31],days:["周日","周一","周二","周三","周四","周五","周六"],beginhour:0,endhour:23,beginminute:0,endminute:59,curdate:!1,liH:35,theme:"date",mode:null,event:"click",show:!0,scrollOpt:{snap:"li",checkDOMChanges:!0},callBack:function(){}};var O=e.extend(!0,{},e.fn.datePicker.defaultOptions,t);O.show?m.on(O.event,function(){l()}):m.off("click")})}}("undefined"!=typeof Zepto?Zepto:jQuery);